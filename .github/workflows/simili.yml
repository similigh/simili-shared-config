name: Simili-Bot Shared Workflow

on:
  workflow_call:
    inputs:
      config_path:
        description: 'Path to the local configuration file'
        required: false
        default: '.github/simili.yaml'
        type: string
    secrets:
      GEMINI_API_KEY:
        required: true
      QDRANT_URL:
        required: true
      QDRANT_API_KEY:
        required: true
      TRANSFER_TOKEN:
        required: false
      SIMILI_APP_ID:
        required: false
      SIMILI_PRIVATE_KEY:
        required: false

jobs:
  triage:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: read
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Checkout Shared Config
        uses: actions/checkout@v4
        with:
          repository: similigh/simili-shared-config
          ref: main
          path: .simili-shared-config

      - name: Run Simili-Bot
        uses: ./.simili-shared-config/.github/actions/simili-bot
        with:
          config_path: ${{ inputs.config_path }}
          github_token: ${{ github.token }}
          gemini_api_key: ${{ secrets.GEMINI_API_KEY }}
          qdrant_url: ${{ secrets.QDRANT_URL }}
          qdrant_api_key: ${{ secrets.QDRANT_API_KEY }}
          transfer_token: ${{ secrets.TRANSFER_TOKEN }}
          simili_app_id: ${{ secrets.SIMILI_APP_ID }}
          simili_private_key: ${{ secrets.SIMILI_PRIVATE_KEY }}
